<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Genesys Cloud & Open AI integration</title>
  <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>
  <script src="https://sdk-cdn.mypurecloud.com/client-apps/2.6.3/purecloud-client-app-sdk-de77761d.min.js"></script>
  <script src="startGCSDKs.js"></script>
  <script src="api.js"></script>
  <script src="dataTable.js"></script>
  <script src="configurations.js"></script>
  <script src="ui.js"></script>
  <script src="init.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <h1>Genesys Cloud & Open AI integration</h1>
  <h2>Setup</h2>

  <!-- Subapartado Knowledge base -->
  <div>
    <h3>Knowledge base</h3>
    <button id="getKnowledgeBasesBtn">Get Knowledge Bases</button>
    <table id="knowledgeBasesTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th></th> <!-- Columna vacía para radio buttons -->
        </tr>
      </thead>
      <tbody id="knowledgeBasesTableBody">
        <!-- Aquí se mostrarán las Knowledge Bases -->
      </tbody>
    </table>
  </div>
  <!-- Subapartado Current Configuration -->
  <div id="currentConfiguration" style="display:none;">
    <h3>Current configuration</h3>
    <form id="currentConfigurationForm">
      <!-- Aquí se mostrarán los mismos campos que en New configuration -->
    </form>
    <button id="updateConfigurationBtn" onclick="updateConfiguration()">Update configuration</button>
  </div>
  <!-- Subapartado New Configuration -->
  <div id="newConfiguration">
    <h3>New configuration</h3>
    <form id="newConfigurationForm">
      <!-- Aquí se mostrarán los mismos campos que en Current configuration -->
    </form>
    <button id="saveConfigurationBtn" onclick="saveNewConfiguration()">Save configuration</button>
  </div>
  <script>
    
    const clientId = '479255ae-cf23-4c2e-9209-555370df882c';
    startGCSDKs(clientId).then(() => {
      registerEventHandlers();
    });

    document.getElementById('knowledgeBasesTable').addEventListener('change', function (event) {
      const selectedKnowledgeBaseId = event.target.value;
      document.getElementById('knowledgeBaseIdNew').value = selectedKnowledgeBaseId;
      displayConfiguration(selectedKnowledgeBaseId);
    });

    
    // Copia la estructura de campos del formulario de configuración a ambos subapartados
    const configurationFields = document.createElement('div');
    configurationFields.innerHTML = `
      <div>
        <!-- Campo Language -->
        <div>
          <label for="language">Language:</label>
          <select id="language">
            <option value="en-US">en-US</option>
            <option value="es-ES">es-ES</option>
          </select>
        </div>

        <!-- Campo Knowledge Base Id -->
        <div>
          <label for="knowledgeBaseId">Knowledge Base Id:</label>
          <input type="text" id="knowledgeBaseId" size="36">
        </div>

        <!-- Campo Minimum answer confidence -->
        <div>
          <label for="minAnswerConfidence">Minimum answer confidence:</label>
          <input type="number" id="minAnswerConfidence" step="0.1" min="0" max="1" size="3" value="0.85">
        </div>

        <!-- Campo System prompt -->
        <div>
          <label for="systemPrompt">System prompt:</label>
          <input type="text" id="systemPrompt" onInput="adjustInputSize(this, 100)" size="100">
        </div>

        <!-- Campo No match behavior -->
        <div>
          <label for="noMatchBehavior">No match behavior:</label>
          <select id="noMatchBehavior">
            <option value="routeToAgent">Route to agent</option>
            <option value="keepBotLoop">Keep the bot loop</option>
          </select>
        </div>   

        <!-- Campo Create knowledge articles based on wrap ups -->
        <div>
          <label for="createKnowledgeArticles">Create knowledge articles based on wrap ups:</label>
          <input type="checkbox" id="createKnowledgeArticles" onchange="toggleWrapUpIdsField()">
        </div>

        <!-- Campo Wrap up ids for knowledge articles (separated by ;) -->
        <div id="wrapUpIdsField" style="display:none;">
          <label for="wrapUpIds">Wrap up ids for knowledge articles (separated by ;):</label>
          <input type="text" id="wrapUpIds">
        </div>

        <!-- Campo Model -->
        <div>
          <label for="model">Model:</label>
          <input type="text" id="model" value="gpt-3.5-turbo">
        </div>

        <!-- Campo Temperature -->
        <div>
          <label for="temperature">Temperature:</label>
          <input type="number" id="temperature" step="0.1" min="0" max="1" size="3" value="0">
        </div>

        <!-- Campo MaxTokens -->
        <div>
          <label for="maxTokens">Max Tokens:</label>
          <input type="number" id="maxTokens" min="0" size="4" value="512">
        </div>
      </div>
    `;
    document.getElementById('currentConfigurationForm').appendChild(configurationFields.cloneNode(true));
    document.getElementById('newConfigurationForm').appendChild(configurationFields.cloneNode(true));
  </script>
</body>
</html>
